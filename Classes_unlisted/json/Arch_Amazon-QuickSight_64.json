{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "Basic Amazon QuickSight Setup",
  "Resources": {
    "QuickSightUser": {
      "Type": "AWS::QuickSight::User",
      "Properties": {
        "UserName": "quicksight-user",  // Replace with your desired username
        "Email": "user@example.com",  // Replace with the user's email
        "IdentityType": "IAM",  // Options: IAM, QUICKSIGHT
        "Role": "READER",  // Options: READER, AUTHOR, ADMIN
        "AwsAccountId": { "Fn::Sub": "${AWS::AccountId}" }
      }
    },
    "QuickSightDataSource": {
      "Type": "AWS::QuickSight::DataSource",
      "Properties": {
        "DataSourceId": "my-data-source",  // Replace with your desired data source ID
        "Name": "MyDataSource",  // Replace with your desired data source name
        "Type": "RDS",  // Specify the data source type (e.g., RDS, S3, etc.)
        "DataSourceParameters": {
          "RdsParameters": {
            "Database": "mydatabase",  // Replace with your database name
            "InstanceId": "mydbinstance",  // Replace with your DB instance identifier
            "Port": 3306  // Replace with your DB port
          }
        },
        "Credential": {
          "CredentialPair": {
            "Username": "db-username",  // Replace with your DB username
            "Password": "db-password"  // Replace with your DB password
          }
        },
        "Permissions": [
          {
            "Principal": { "Fn::Sub": "quicksight-user" },  // Use the QuickSight user created above
            "Actions": [
              "quicksight:DescribeDataSource",
              "quicksight:UpdateDataSource"
            ]
          }
        ]
      }
    }
  },
  "Outputs": {
    "UserArn": {
      "Description": "ARN of the QuickSight User",
      "Value": { "Fn::GetAtt": ["QuickSightUser", "Arn"] }
    },
    "DataSourceArn": {
      "Description": "ARN of the QuickSight Data Source",
      "Value": { "Fn::GetAtt": ["QuickSightDataSource", "Arn"] }
    }
  }
}
